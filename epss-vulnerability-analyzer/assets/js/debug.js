/**
 * EPSS Analyzer Debug Helper
 * This file helps diagnose AJAX errors with the EPSS Analyzer
 */
(function($) {
    'use strict';
    
    // Monitor AJAX calls
    $(document).ajaxSend(function(event, jqXHR, settings) {
        console.group('AJAX Request Started');
        console.log('URL:', settings.url);
        console.log('Type:', settings.type);
        console.log('Data:', settings.data);
        console.groupEnd();
    });
    
    $(document).ajaxSuccess(function(event, jqXHR, settings, response) {
        console.group('AJAX Request Successful');
        console.log('URL:', settings.url);
        console.log('Response:', response);
        console.groupEnd();
    });
    
    $(document).ajaxError(function(event, jqXHR, settings, error) {
        console.group('AJAX Request Failed');
        console.log('URL:', settings.url);
        console.log('Status:', jqXHR.status);
        console.log('Status Text:', jqXHR.statusText);
        console.log('Response Text:', jqXHR.responseText);
        console.log('Error:', error);
        
        // Additional debugging info
        if (jqXHR.status === 500) {
            console.error('Server error (500) detected. This typically indicates a PHP error on the server.');
            console.log('Check WordPress debug.log for PHP errors');
            console.log('Try adding "define(\'WP_DEBUG\', true);" to wp-config.php');
            console.log('Also add "define(\'WP_DEBUG_LOG\', true);" to log errors to wp-content/debug.log');
        }
        
        console.groupEnd();
    });
    
    // Add debug button to the page
    $(document).ready(function() {
        $('.epss-analyzer-container').append(
            '<div class="epss-debug-tools" style="margin-top: 20px; padding: 10px; background: #333; border: 1px solid #555;">' +
            '<h4 style="color: #7ede3b; margin-top: 0;">Debug Tools</h4>' +
            '<button id="epss-debug-test" class="button">Test AJAX Connection</button>' +
            '<div id="epss-debug-output" style="margin-top: 10px; padding: 10px; background: #222; color: #fff; display: none;"></div>' +
            '</div>'
        );
        
        // Test AJAX connection
        $('#epss-debug-test').on('click', function() {
            const $output = $('#epss-debug-output');
            $output.html('Testing AJAX connection...').show();
            
            $.ajax({
                url: epss_analyzer_vars.ajax_url,
                type: 'POST',
                data: {
                    action: 'epss_test_connection',
                    nonce: epss_analyzer_vars.nonce
                },
                success: function(response) {
                    $output.html('AJAX connection successful! Response: ' + JSON.stringify(response));
                },
                error: function(xhr, status, error) {
                    $output.html('AJAX connection failed: ' + status + ' - ' + error + '<br>Response: ' + xhr.responseText);
                }
            });
        });
    });
    
})(jQuery); 